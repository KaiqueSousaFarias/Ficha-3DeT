<?xml version="1.0" encoding="UTF-8"?>
<group>
	<popup name="popAttribute" width="410" height="370" backOpacity="0.4" autoScopeNode="false" g-cnt-line-spacing="1" g-cnt-gutter="1">
		<label g="col" g-width="2" text="Inicial" horzTextAlign="center" height="25" textTrimming="none"/>
		<label g="col" g-width="2" text="Raça" horzTextAlign="center" height="25" textTrimming="none"/>
		<label g="col" g-width="2" text="NEP" horzTextAlign="center" height="25" textTrimming="none"/>
		<label g="col" g-width="2" text="Inerente" horzTextAlign="center" height="25" textTrimming="none"/>
		<label g="col" g-width="2" text="Tamanho" horzTextAlign="center" height="25" textTrimming="none"/>
		<label g="col" g-width="2" text="Outros" horzTextAlign="center" height="25" textTrimming="none"/>

		<attributeFlowReal atr="For"/>
		<attributeFlowReal atr="Hab"/>
		<attributeFlowReal atr="Res"/>
		<attributeFlowReal atr="Arm"/>
		<attributeFlowReal atr="PdF"/>

		<checkBox g="col" g-width="2" text="Melhoria" field="isMelhoriaActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>
		<checkBox g="col" g-width="2" text="Dn Temp." field="isDnTempActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>
		<checkBox g="col" g-width="2" text="Dn Perm." field="isDnPermActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>
		<checkBox g="col" g-width="2" text="Temp." field="isTempActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>
		<checkBox g="col" g-width="2" text="Classe" field="isClasseActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>
		<checkBox g="col" g-width="2" text="Magia" field="isMagiaActive" horzTextAlign="center" height="25" textTrimming="none" fontSize="11"/>

		<attributeFlowEfet atr="For"/>
		<attributeFlowEfet atr="Hab"/>
		<attributeFlowEfet atr="Res"/>
		<attributeFlowEfet atr="Arm"/>
		<attributeFlowEfet atr="PdF"/>
	</popup>

	<popup name="popResistencia" width="380" height="150" backOpacity="0.4" autoScopeNode="false">
		<flowLayout align="top" autoHeight="true" maxControlsPerLine="11" margins="{bottom=4}" horzAlign="center">
			<smallTitleCenter text="Base"/>
			<smallTitleCenter text="Atributo"/>
			<smallTitleCenter text="Magia"/>
			<smallTitleCenter text="Melhoria"/>
			<smallTitleCenter text="Temp."/>
			<smallTitleCenter text="Outros"/>
			<smallTitleCenter text=""/>
		</flowLayout>
		<resitenceFlow tr="Fort"/>
		<resitenceFlow tr="Ref"/>
		<resitenceFlow tr="Von"/>
		<textEditor align="client" field="trCondicional"/>

		<dataLink field="atrTrFort" defaultValue="3"/>
		<dataLink field="atrTrRef" defaultValue="2"/>
		<dataLink field="atrTrVon" defaultValue="5"/>
	</popup>

	<popup name="popArma" width="300" height="400" backOpacity="0.4" autoScopeNode="false">
		<flowLayout align="top" autoHeight="true" maxControlsPerLine="3" margins="{bottom=4}" horzAlign="center">
			<weaponInfoFieldSmall text="NOME" field="batismo" hint="Se a arma possui um nome de batismo ponha ele aqui."/>
			<weaponInfoFieldSmall text="ARMA" field="arma" hint="Qual a arma? Espada Longa? Machado de Batalha? Arco Longo?"/>
			<weaponInfoFieldSmall text="TAMANHO" field="tamanho" hint="Essa arma foi feita para um personagem de que tamanho? Médio? Pequeno? Grande?"/>
			<weaponInfoFieldSmall text="MATERIAL" field="material" hint="Essa arma foi feita de um material especial? Adamante? Prata?"/>
			<weaponInfoFieldSmallCenter text="QUALIDADE" field="qualidade" hint="Essa arma é Obra-Prima? +1? +2?"/>
			<weaponInfoFieldSmall text="CATEGORIA" field="categoria" hint="Essa arma é Simples? Comum? Exotica?"/>
			<weaponInfoFieldSmallCenter text="DANO" field="dano" hint="Qual o dado de dano dessa arma?"/>
			<weaponInfoFieldSmallCenter text="DECISIVO" field="decisivo" hint="Quando a margem de ameaça dessa arma?20? 19-20?"/>
			<weaponInfoFieldSmallCenter text="MULTIPLICADOR" field="multiplicador" hint="Em um decisivo por quanto é multiplicado o dano dessa arma?"/>
			<weaponInfoFieldSmall text="ALCANCE" field="alcance" hint="Qual o alcance em metros da arma? Normalmente usado apenas em armas de ataque a distancia. "/>
			<weaponInfoFieldSmall text="ESPECIAL" field="especial" hint="Essa arma tem efeitos especiais? Pode ser usada em derrubar? desarmar? Pode ser preparada contra investida?"/>
			<weaponInfoFieldSmall text="TIPO" field="tipo" hint="Qual o tipo de dano que essa arma causa? Concusivo? Cortante?"/>
			<weaponInfoField text="EFEITOS" field="efeitos" hint="Essa arma tem efeitos mágicos? Flamejante? Vorpal?"/>
			<weaponInfoFieldSmallCenter text="CA" field="ca" hint="Para escudos: qual o bonus que ele fornece na CA?"/>
			<weaponInfoFieldSmallCenter text="PEN" field="penalidade" hint="Para escudos: qual a penalidade do escudo?"/>
			<weaponInfoFieldSmallCenter text="FALHA" field="falha" hint="Para escudos: qual a falha arcana?"/>
		</flowLayout>
		<textEditor align="client" field="descricao" class=""/>
	</popup>

	<popup name="popHabilidade" width="300" height="240" backOpacity="0.4" autoScopeNode="false">
		<flowLayout align="top" autoHeight="true" maxControlsPerLine="3" margins="{bottom=4}" horzAlign="center">
			<habilidadeSmallCenter text="Pontos" field="pontosHabilidade"/>
			<habilidadeLarge text="Livro" field="livroHabilidade"/>
			<habilidadeSmallCenter text="Custo" field="custoHabilidade"/>
			<habilidadeLarge text="Rolagem" field="rolagemHabilidade"/>
			<dataLink field="pontosHabilidade">
				<event name="onUserChange">
					local rcl = self:findControlByName("rclListaDosTalentos");
					if rcl~= nil then
						rcl:sort();
					end;
					rcl = self:findControlByName("rclListaDosOutros");
					if rcl~= nil then
						rcl:sort();
					end;
					rcl = self:findControlByName("rclListaDasCaracteristicasClasse");
					if rcl~= nil then
						rcl:sort();
					end;
				</event>
			</dataLink>
		</flowLayout>
		<textEditor align="client" field="descricao"/>
		<button align="top" height="25" text="Exibir">
			<event name="onClick">
				local txt = "\n";
				local node = self.popHabilidade.node;
				if (node.nomeHabilidade ~= nil) then txt = txt .. "Nome: " .. node.nomeHabilidade .. "\n" end;
				if (node.pontosHabilidade ~= nil) then txt = txt .. "Pontos: " .. node.pontosHabilidade .. "\n" end;
				if (node.custoHabilidade ~= nil) then txt = txt .. "Custo: " .. node.custoHabilidade .. "\n" end;
				if (node.descricao ~= nil) then txt = txt .. "Descrição: " .. node.descricao end;

				local mesa = Firecast.getMesaDe(node);
				if mesa ~= nil then
				mesa.activeChat:enviarMensagem(txt);
				end;
			</event>
		</button>
	</popup>

	<popup name="BarPopup" width="140" height="66" backOpacity="0" margins="{left=4, right=4, top=4, bottom=4}" autoScopeNode="false">
		<rectangle align="client" color="white" xradius="5" yradius="5">
			<rectangle align="client" name="PopupBarColor" color="#808080" xradius="5" yradius="5" opacity="0.9">
				<label fontColor="black" margins="{left=6, top=2}" align="top" text="Valor" field="AtributoBarrinha" fontSize="12" fontStyle="bold" textTrimming="character"/>
				<layout align="client" margins="{top=2, left=4}">
					<layout align="top" height="18">
						<label fontColor="black" align="left" text="Atual:  " horzTextAlign="trailing" width="34" margins="{right=2}" fontSize="12"/>
						<comboBox fontColor="white" margins="{left=2}" align="left" transparent="false" width="40" field="ModificadorBarrinha" items="{'=', '+', '-'}" values="{'igual', 'mais', 'menos'}" value="igual"/>
						<edit fontColor="white" margins="{left=2, right=4}" type="number" align="client" field="ValorMudadoAtualBarrinha" name="currentBarValue">
							<event name="OnKeyDown">
								local oenter = (event.keyCode == 13)
								if oenter then
								self.BarPopup:close();
								end;
							</event>
						</edit>
					</layout>
					<layout align="top" height="18">
						<label fontColor="black" align="left" text="Max:  " horzTextAlign="trailing" width="34" margins="{right=2}" fontSize="12"/>
						<comboBox fontColor="white" margins="{left=2}" align="left" transparent="false" width="40" field="ModificadorBarrinhaMax" items="{'=', '+', '-'}" values="{'igual', 'mais', 'menos'}" value="igual"/>
						<edit fontColor="white" margins="{left=2, right=4}" type="number" align="client" field="ValorMudadoMaxBarrinha" name="maxBarValue">
							<event name="OnKeyDown">
								local oenter = (event.keyCode == 13);
								if oenter then
								self.BarPopup:close();
								end;
							</event>
						</edit>
					</layout>
				</layout>
			</rectangle>
		</rectangle>

		<event name="onNodeReady">
			local node = self.BarPopup.scopeNode
			if node == nil then return end

			local selectedBar = node.selectedBar

			node.AtributoBarrinha = node["Atributo"..selectedBar]
			node.ValorMudadoAtualBarrinha = node["ValorMudadoAtual"..selectedBar]
			node.ValorMudadoMaxBarrinha = node["ValorMudadoMax"..selectedBar]
		</event>

		<event name="onClose">
			setTimeout( function()
			local node = self.BarPopup.scopeNode
			if node == nil then return end

			local selectedBar = node.selectedBar

			if (node.ModificadorBarrinha == "igual") then
			node["ValorTempAtual"..selectedBar] = tonumber(node.ValorMudadoAtualBarrinha or 0);
			elseif (node.ModificadorBarrinha == "mais") then
			node["ValorTempAtual"..selectedBar] = tonumber(node["ValorTempAtual"..selectedBar] or 0) + tonumber(node.ValorMudadoAtualBarrinha or 0);
			elseif (node.ModificadorBarrinha == "menos") then
			node["ValorTempAtual"..selectedBar] = tonumber(node["ValorTempAtual"..selectedBar] or 0) - tonumber(node.ValorMudadoAtualBarrinha or 0);
			end;

			if (node.ModificadorBarrinhaMax == "igual") then
			node["ValorTempMax"..selectedBar] = tonumber(node.ValorMudadoMaxBarrinha or 0);
			elseif (node.ModificadorBarrinhaMax == "mais") then
			node["ValorTempMax"..selectedBar] = tonumber(node["ValorTempMax"..selectedBar] or 0) + tonumber(node.ValorMudadoMaxBarrinha or 0);
			elseif (node.ModificadorBarrinhaMax == "menos") then
			node["ValorTempMax"..selectedBar] = tonumber(node["ValorTempMax"..selectedBar] or 0) - tonumber(node.ValorMudadoMaxBarrinha or 0);
			end;

			local barrinhapc = 0
			local barrinhapcmax = 0
			local porcentagem = 0
			local porcentagemmax = 0

			barrinhapc = (node["ValorTempAtual"..selectedBar] - (node[selectedBar.."Valor"] or 0));
			barrinhapcmax = (node["ValorTempMax"..selectedBar] - (node[selectedBar.."ValorMax"] or 0));
			node[selectedBar.."Valor"] = node["ValorTempAtual"..selectedBar];
			node[selectedBar.."ValorMax"] = node["ValorTempMax"..selectedBar];

			if ((barrinhapc ~= 0) or (barrinhapcmax ~= 0)) then
			local nome = node.AtributoBarrinha or "Barrinha";
			local personagem = sheet.nome or "personagem";
			local text = "[§K2]" .. nome .. "[§K3] de [§K2]" .. personagem.. "[§K3]: ";
			local valor = barrinhapc;
			local valormax = barrinhapcmax;

			if tonumber(barrinhapc) >= 0 then
			valor = "+" .. tostring(barrinhapc);
			end;
			if tonumber(barrinhapcmax) >= 0 then
			valormax = "+" .. tostring(barrinhapcmax);
			end;

			if tonumber(valormax) == 0 then
			text = text .. valor;
			else
			text = text .. valor .. "/" .. valormax;
			end;

			local mesaDoPersonagem = Firecast.getMesaDe(sheet);
			if mesaDoPersonagem ~= nil then
			mesaDoPersonagem.activeChat:enviarMensagem(text);
			end;
			end;
			end, 100);
		</event>
	</popup>
</group>